<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fracciones 4¬∫ ‚Äî Figuras ‚Üí Fracci√≥n (m√≥dulo separado)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--azul:#2563eb;--verde:#10b981;--amarillo:#f59e0b;--rojo:#ef4444;--gris:#f1f5f9;--texto:#0f172a;--borde:#e2e8f0;--radius:16px}
    body{background:linear-gradient(180deg,#f8fbff 0%,#fff 100%);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--texto)}
    .game-card{border:none;border-radius:1rem;box-shadow:0 10px 28px rgba(2,6,23,.08)}
    .title-badge{background:linear-gradient(90deg,var(--azul),var(--verde));-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800}
    .score-chip{font-weight:800;border-radius:999px;padding:.45rem 1rem;background:#eef7ff;color:#0d47a1;border:1px solid #d7ebff}
    .btn-fab{border-radius:999px;padding:.65rem 1rem;font-weight:700;box-shadow:0 6px 20px rgba(30,136,229,.25)}

    .task{border:1px solid var(--borde);border-radius:14px;padding:1rem;background:#fff}
    .task h3{font-size:1.05rem;margin:0 0 .25rem;font-weight:800;color:#0b1b44}
    .badge-kind{background:#f1f5f9;border:1px solid #e2e8f0;color:#0f172a;border-radius:999px;padding:.15rem .5rem;font-size:.75rem;font-weight:800}
    .mark{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;font-weight:900;box-shadow:0 2px 6px rgba(0,0,0,.08)}
    .ok{background:#dcfce7;color:#15803d;border:2px solid #86efac}
    .bad{background:#fee2e2;color:#b91c1c;border:2px solid #fecaca;animation:shake .35s ease}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-2px)}50%{transform:translateX(2px)}75%{transform:translateX(-2px)}100%{transform:translateX(0)}}

    .frac{display:inline-grid;grid-template-rows:auto auto;line-height:1;vertical-align:middle}
    .frac .top{border-bottom:3px solid #111;padding:0 .35rem;text-align:center;font-weight:900}
    .frac .bottom{text-align:center;padding:.05rem .35rem;font-weight:900}

    /* ‚Äî‚Äî Barra fija (paleta) ‚Äî‚Äî */
    .sticky-toolbar{position:sticky;top:0;z-index:1050;background:#fff;border-bottom:1px solid var(--borde);padding:.5rem .75rem;border-radius:12px}
    .palette{
      position:relative;
      min-height:68px;background:var(--gris);border-radius:12px;padding:8px;
      padding-right:120px;
      display:flex;gap:8px;align-items:center;justify-content:flex-start;
      border:1px solid var(--borde);overflow:auto
    }
    .tile{min-width:56px;height:56px;border-radius:12px;background:#fff;border:2px solid #e5e7eb;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1.3rem;user-select:none;cursor:grab;box-shadow:0 6px 14px rgba(2,6,23,.06)}
    .tile:active{cursor:grabbing;transform:scale(1.04)}
    .tile[data-t="eraser"]{border-color:#fecaca;background:#fff1f2}
    .dragging{position:fixed;z-index:1100;pointer-events:none;filter:drop-shadow(0 10px 16px rgba(0,0,0,.25))}

    /* Drops */
    .drop{min-width:58px;min-height:52px;border:2px dashed #cbd5e1;border-radius:12px;background:#f8fafc;display:inline-flex;align-items:center;justify-content:center;padding:.25rem .4rem}
    .drop.fill{border-style:solid;border-color:#93c5fd;background:#eff6ff}
    .drop-char{font-weight:900;font-size:1.35rem}

    /* Figuras (pasteles) */
    .pie{width:92px;height:92px}

    /* Bot√≥n Men√∫ (peque√±o y parpadeante) */
    .btn-menu{
      display:inline-block; padding:.45rem .9rem; font-weight:800; border:none; border-radius:999px;
      background:#ef4444; color:#fff; box-shadow:0 6px 18px rgba(239,68,68,.32); white-space:nowrap;
      animation:blink 1.15s infinite;
    }
    .menu-in-palette{position:absolute; right:10px; top:50%; transform:translateY(-50%); z-index:1;}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.45}}
  </style>
</head>
<body>
  <div class="container py-4 py-md-5">
    <div class="row justify-content-center">
      <div class="col-12 col-xxl-10">
        <div class="card game-card">
          <div class="card-body p-3 p-md-4 p-lg-5">

            <header class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-3">
              <div>
                <h1 class="h3 m-0 title-badge">Fracciones 4¬∫ ‚Äî Figuras ‚Üí Fracci√≥n</h1>
                <p class="text-secondary m-0">M√≥dulo independiente para practicar <strong>fracciones con gr√°ficos</strong>. La <strong>barra de n√∫meros</strong> queda fija arriba para arrastrar en tablet o celular.</p>
              </div>
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <span id="score" class="score-chip" aria-live="polite">Puntaje: 0 / 100</span>
                <button id="howBtn" class="btn btn-outline-secondary btn-fab">‚ùì ¬øC√≥mo jugar?</button>
                <button id="checkBtn" class="btn btn-success btn-fab">‚úîÔ∏è Revisar</button>
                <button id="resetBtn" class="btn btn-primary btn-fab">üîÑ Nueva tanda</button>
              </div>
            </header>

            <!-- BARRA FIJA: paleta para arrastrar -->
            <div class="sticky-toolbar mb-3" id="dragRow" aria-label="Barra fija de d√≠gitos">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <span class="fw-bold small text-secondary">Arrastra: 0‚Äì9, coma ‚Äú,‚Äù y üßΩ para borrar</span>
                <small class="text-muted d-none d-md-inline">Siempre visible mientras te desplazas</small>
              </div>
              <div id="palette" class="palette"></div>
            </div>

            <div class="row g-3">
              <div class="col-12">
                <div id="tasks" class="row g-3">
                  <!-- Tarjetas de ejercicios -->
                </div>
              </div>
            </div>

            <div class="mt-3 small text-muted">Tip: arrastra d√≠gitos para <strong>numerador</strong> y <strong>denominador</strong> seg√∫n la figura.</div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal ¬øC√≥mo jugar? -->
  <div class="modal fade" id="howModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title">¬øC√≥mo se juega?</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <ol class="mb-0 ps-3">
            <li>Observa la <strong>figura</strong> (pastel) y cu√°ntas partes est√°n coloreadas.</li>
            <li>Usa la <strong>barra fija</strong> para arrastrar los d√≠gitos a <em>numerador</em> y <em>denominador</em>.</li>
            <li>Pulsa <strong>‚úîÔ∏è Revisar</strong> para ver ‚úì y ‚úñ y tu nota. Con <strong>üîÑ Nueva tanda</strong> obtienes nuevos ejercicios.</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal resultado -->
  <div class="modal fade" id="resultModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center p-2 p-md-3">
        <div class="modal-header border-0 justify-content-center">
          <div class="display-4">üéâ‚ú®</div>
        </div>
        <div class="modal-body">
          <h3 id="resultTitle" class="mb-2">¬°Excelente!</h3>
          <p id="resultText" class="lead mb-0"></p>
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Seguir practicando</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  // ========= Utilidades =========
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const rndInt = (a,b) => Math.floor(Math.random()*(b-a+1))+a; // [a,b]

  // ========= Paleta + drag =========
  const palette = document.getElementById('palette');
  function makeTile(txt, kind='digit'){
    const el = document.createElement('div');
    el.className = 'tile'; el.textContent = txt; el.dataset.t = kind; makeDraggable(el); return el;
  }
  function renderPalette(){
    if(!palette) return;
    palette.innerHTML='';
    for(let i=0;i<=9;i++) palette.appendChild(makeTile(i.toString(),'digit'));
    palette.appendChild(makeTile(',', 'comma'));
    palette.appendChild(makeTile('üßΩ','eraser'));

    // Bot√≥n Men√∫ dentro de la barra fija
    const btn = document.createElement('button');
    btn.className = 'btn-menu menu-in-palette';
    btn.textContent = '‚Üê Men√∫ principal';
    btn.onclick = ()=>{ location.href = 'index.html'; };
    palette.appendChild(btn);
  }
  function makeDraggable(src){
    src.addEventListener('pointerdown',(e)=>{
      const ghost = src.cloneNode(true); ghost.classList.add('dragging'); document.body.appendChild(ghost);
      const r = ghost.getBoundingClientRect(); let offX=r.width/2, offY=r.height/2;
      moveAt(e.clientX,e.clientY);
      function moveAt(x,y){ ghost.style.left=(x-offX)+'px'; ghost.style.top=(y-offY)+'px'; }
      function onMove(ev){ moveAt(ev.clientX,ev.clientY); highlight(ev.clientX,ev.clientY); }
      function onUp(ev){ document.removeEventListener('pointermove',onMove); document.removeEventListener('pointerup',onUp); dropAt(ev.clientX,ev.clientY,ghost); ghost.remove(); }
      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', onUp, {once:true});
    });
  }
  function elementAt(x,y){ return document.elementFromPoint(x,y); }
  function highlight(x,y){
    $$('.drop').forEach(d=>d.classList.remove('fill'));
    const el = elementAt(x,y);
    const cell = el && (el.classList?.contains('drop') ? el : el.closest?.('.drop'));
    if(cell) cell.classList.add('fill');
  }
  function dropAt(x,y,ghost){
    $$('.drop').forEach(d=>d.classList.remove('fill'));
    const el = elementAt(x,y);
    const cell = el && (el.classList?.contains('drop') ? el : el.closest?.('.drop'));
    if(!cell) return;
    const val = ghost.textContent.trim();
    if(ghost.dataset.t==='eraser'){ setDrop(cell, ''); return; }
    if(ghost.dataset.t==='digit' || ghost.dataset.t==='comma'){ setDrop(cell, val); }
  }
  function setDrop(cell, val){ cell.dataset.char = val || ''; cell.innerHTML = val? `<span class="drop-char">${val}</span>` : ''; }
  function dropHTML(id){ return `<div class="drop" data-id="${id}"></div>` }

  // ========= Figuras (SVG pastel) =========
  function svgPie(den, num){
    const cx=50, cy=50, r=45; let parts='';
    for(let k=0;k<den;k++){
      const a0 = (k/den)*2*Math.PI; const a1=((k+1)/den)*2*Math.PI;
      const x0=cx + r*Math.cos(a0), y0=cy + r*Math.sin(a0);
      const x1=cx + r*Math.cos(a1), y1=cy + r*Math.sin(a1);
      const largeArc = (a1-a0) > Math.PI ? 1:0;
      const fill = k<num? '#f59e0b' : '#e5e7eb';
      parts += `<path d="M ${cx} ${cy} L ${x0} ${y0} A ${r} ${r} 0 ${largeArc} 1 ${x1} ${y1} Z" fill="${fill}" stroke="#cbd5e1"/>`;
    }
    return `<svg viewBox="0 0 100 100" class="pie" aria-label="${num} de ${den}">${parts}<circle cx="50" cy="50" r="46" fill="none" stroke="#94a3b8"/></svg>`;
  }

  // ========= Generadores =========
  function buildCard(idx, kind, promptHTML, inputHTML){
    return `
      <div class="col-12 col-md-6">
        <div class="task h-100">
          <div class="d-flex justify-content-between align-items-start mb-1">
            <h3>Ejercicio ${idx+1}</h3>
            <span class="badge-kind">${kind}</span>
          </div>
          <div class="mb-2">${promptHTML}</div>
          <div id="t${idx}-wrap">${inputHTML}</div>
          <div class="mt-2"><span id="t${idx}-mark" class="mark" style="visibility:hidden">‚úì</span></div>
        </div>
      </div>`
  }

  // √önico m√≥dulo: Figuras ‚Üí Fracci√≥n
  function genFIG(){
    const items=[];
    for(let i=0;i<8;i++){
      const den = rndInt(3,8); // 3 a 8 partes
      const num = rndInt(1,den-1);
      const prompt = `¬øQu√© fracci√≥n representa la figura? ${svgPie(den,num)}`;
      const ids = [`t${i}n`,`t${i}d`];
      const input = `<div class="d-flex align-items-center gap-2">
        <span class="frac">
          <span class="top">${dropHTML(ids[0])}</span>
          <span class="bottom">${dropHTML(ids[1])}</span>
        </span>
      </div>`;
      const check = (map)=>{
        const n = Number(map[ids[0]]||NaN), d = Number(map[ids[1]]||NaN);
        return n===num && d===den;
      };
      items.push({html:buildCard(i,'Figuras ‚Üí Fracci√≥n',prompt,input), check});
    }
    return items;
  }

  // ========= Estado / Render =========
  let cards = [];

  function renderAll(){
    const wrap = $('#tasks');
    wrap.innerHTML = cards.map(x=>x.html).join('');
    setScore(0);
  }
  function setScore(v){ $('#score').textContent = `Puntaje: ${Math.round(v)} / 100`; }
  function collect(){
    const map={};
    $$('.drop').forEach(d=>{ if(d.dataset.id) map[d.dataset.id]= d.dataset.char||''; });
    return map;
  }
  function checkAll(){
    const map = collect(); let okc=0;
    cards.forEach((c,i)=>{
      const ok = !!c.check(map);
      const mk = $(`#t${i}-mark`); mk.style.visibility='visible'; mk.textContent = ok? '‚úì':'‚úñ'; mk.className = 'mark ' + (ok?'ok':'bad');
      if(ok) okc++;
    });
    const val = (okc/cards.length)*100; setScore(val); showResult(val);
  }

  // === Confeti cuando hay 100% ===
  function confetti(){
    const burst=document.createElement('div');
    burst.style.position='fixed';
    burst.style.inset='0';
    burst.style.pointerEvents='none';
    burst.style.zIndex='2000';
    document.body.appendChild(burst);
    const emojis=['‚ú®','üéâ','‚≠ê','üéØ','üí´','üèÜ'];
    for(let i=0;i<70;i++){
      const s=document.createElement('div');
      s.textContent=emojis[Math.floor(Math.random()*emojis.length)];
      s.style.position='absolute';
      s.style.left=Math.random()*100+'%';
      s.style.top='-10%';
      s.style.fontSize=(16+Math.random()*22)+'px';
      s.style.transition='transform 1.5s ease, opacity 1.5s ease';
      burst.appendChild(s);
      requestAnimationFrame(()=>{
        s.style.transform='translateY('+(120+Math.random()*140)+'vh) rotate('+(Math.random()*360)+'deg)';
        s.style.opacity='0';
      });
    }
    setTimeout(()=>burst.remove(),1600);
  }

  function showResult(val){
    const title = $('#resultTitle'); const text = $('#resultText');
    if(val === 100){
      title.textContent = '¬°Has ganado!';
      text.textContent = '¬°Sacaste un 100! üòä Sigue as√≠.';
      confetti();                     // üéâ aqu√≠ se lanza el confeti
    }
    else if(val >= 70){
      title.textContent = '¬°Muy bien!';
      text.textContent = `Tu puntaje fue ${val.toFixed(0)} / 100. Revisa los que quedaron en rojo y vuelve a intentar.`;
    }
    else {
      title.textContent = '¬°T√∫ puedes!';
      text.textContent = `Tu puntaje fue ${val.toFixed(0)} / 100. Practica un poco m√°s y lo lograr√°s.`;
    }
    new bootstrap.Modal('#resultModal').show();
  }

  function newRound(){
    cards = genFIG();
    renderAll();
    renderPalette(); // barra fija visible siempre
  }

  // Eventos
  document.addEventListener('click',(e)=>{
    if(e.target.id==='checkBtn') checkAll();
    if(e.target.id==='resetBtn') newRound();
    if(e.target.id==='howBtn') new bootstrap.Modal('#howModal').show();
  });

  // Inicio
  newRound();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
