<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego: Recta Num√©rica 0‚Äì5 (Arrastra y suelta)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --azul:#1e88e5; --rojo:#e53935; --verde:#43a047; --amarillo:#fbc02d; --gris:#e9ecef; --oscuro:#343a40;
      --tri-base: clamp(14px, 4vw, 22px);
      --tri-height: calc(var(--tri-base) * 2);
      --pad-left: clamp(28px, 4vw, 56px);
      --pad-right: clamp(32px, 5vw, 80px);
      --line-inset-left: 0px;
      --line-inset-right: clamp(40px, 5vw, 80px);
    }
    body{ background:linear-gradient(180deg,#f7fbff 0%,#fff 100%); font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; }
    .game-card{ border:none; border-radius:1rem; box-shadow:0 10px 30px rgba(0,0,0,.08); }
    .title-badge{ background:linear-gradient(90deg,var(--azul),var(--verde)); -webkit-background-clip:text; background-clip:text; color:transparent; font-weight:800; }

    .marker{ display:inline-flex; flex-direction:column; align-items:center; gap:4px; cursor:grab; user-select:none; touch-action:none; filter:drop-shadow(0 6px 16px rgba(0,0,0,.15)); }
    .marker:active{ cursor:grabbing; transform:scale(1.04); }
    .marker .tag{ padding:0; margin-top:4px; border-radius:0; background:transparent; color:#000; font-weight:800; font-size:clamp(.8rem,1.8vw,.95rem); line-height:1; }
    .marker .tri{ width:0; height:0; border-left:12px solid transparent; border-right:12px solid transparent; border-bottom:18px solid var(--azul); }
    .marker[data-color="rojo"] .tri{ border-bottom-color:var(--rojo); }
    .marker[data-color="verde"] .tri{ border-bottom-color:var(--verde); }
    .marker[data-color="amarillo"] .tri{ border-bottom-color:var(--amarillo); }
    .marker[data-color="azul"] .tri{ border-bottom-color:var(--azul); }

    .palette{ min-height:88px; background:var(--gris); border-radius:.75rem; padding:12px; gap:12px; display:flex; flex-wrap:wrap; align-items:center; justify-content:center; }

    .numberline-wrap{ position:relative; width:100%; padding:32px var(--pad-right) 56px var(--pad-left); }
    .numberline{ position:relative; height:6px; background:#cfd8dc; border-radius:999px; }
    .tick{ position:absolute; width:2px; background:#455a64; transform:translateX(-1px); }
    .tick.major{ height:18px; top:-6px; }
    .tick.minor{ height:10px; top:-2px; background:#90a4ae; }
    .label{ position:absolute; transform:translate(-50%, 8px); font-weight:700; color:#37474f; }

    .target{ position:absolute; top:50%; transform:translate(-50%, -50%); width:1px; height:1px; pointer-events:none; }

    .score-chip{ font-weight:800; border-radius:999px; padding:.4rem .9rem; background:#eef7ff; color:#0d47a1; border:1px solid #d7ebff; }
    .legend{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .legend > span{ display:inline-flex; align-items:center; gap:6px; }
    .legend .dot{ width:14px; height:14px; border-radius:50%; display:inline-block; }

    .btn-fab{ border-radius:999px; padding:.7rem 1rem; font-weight:700; box-shadow:0 6px 20px rgba(30,136,229,.25); }
    .guide-line{ position:absolute; top:0; bottom:0; width:2px; background:rgba(0,0,0,.12); pointer-events:none; display:none; }

    /* Bot√≥n ‚ÄúMen√∫ principal‚Äù centrado abajo (fuera de la tarjeta) */
    .back-global{
      display:flex; justify-content:center; align-items:center;
      margin-top:22px; margin-bottom:72px; width:100%;
    }
    .btn-back{
      background:#e53935; color:#fff; border:none; border-radius:999px;
      padding:.80rem 1.2rem; font-weight:900; letter-spacing:.3px;
      box-shadow:0 8px 18px rgba(229,57,53,.35);
      animation:blink 1.15s ease-in-out infinite;
    }
    .btn-back:focus{ outline:3px solid rgba(255,255,255,.6); outline-offset:2px; }
    .btn-back:hover{ filter:brightness(1.05); }
    @keyframes blink{
      0%,100%{ transform:scale(1); box-shadow:0 0 0 0 rgba(229,57,53,.55); }
      50%{ transform:scale(1.05); box-shadow:0 0 0 12px rgba(229,57,53,0); }
    }

    @media(max-width:576px){
      .marker .tag{ font-size:0.7rem; }
      .numberline-wrap{ padding:24px var(--pad-right) 48px var(--pad-left); }
    }
  </style>
</head>
<body>
  <div class="container py-4 py-md-5">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10">
        <div class="card game-card">
          <div class="card-body p-3 p-md-4 p-lg-5">

            <header class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
              <div>
                <h1 class="h3 m-0 title-badge">Recta Num√©rica Interactiva (0 a 5)</h1>
                <p class="text-secondary m-0">Arrastra cada tri√°ngulo a su posici√≥n en la recta. ¬°Gana puntos por precisi√≥n!</p>
              </div>
              <div class="d-flex align-items-center gap-2">
                <span id="score" class="score-chip" aria-live="polite">Puntaje: 0 / 100</span>
                <button id="resetBtn" class="btn btn-primary btn-fab"><span class="me-1">üîÑ</span> Nueva ronda</button>
              </div>
            </header>

            <div class="legend mb-3">
              <span><i class="dot" style="background:var(--azul)"></i>Azul</span>
              <span><i class="dot" style="background:var(--rojo)"></i>Rojo</span>
              <span><i class="dot" style="background:var(--verde)"></i>Verde</span>
              <span><i class="dot" style="background:var(--amarillo)"></i>Amarillo</span>
              <span class="text-secondary">‚á¢ Tri√°ngulo = n√∫mero decimal aleatorio dentro de un segmento [n, n+1]</span>
            </div>

            <div class="numberline-wrap">
              <div id="numberline" class="numberline"></div>
              <div id="guide" class="guide-line"></div>
            </div>

            <div class="mb-2 d-flex align-items-center justify-content-between">
              <h2 class="h6 m-0">N√∫meros para colocar</h2>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="snapToggle" checked>
                <label class="form-check-label" for="snapToggle">Ajuste (tolerancia)</label>
              </div>
            </div>
            <div id="palette" class="palette" aria-label="N√∫meros disponibles"></div>

            <div class="mt-3 small text-muted">Consejito: coloca la punta del tri√°ngulo justo sobre la raya correcta.</div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√≥n centrado debajo de la tarjeta -->
  <div class="back-global">
    <button id="backBtn" class="btn-back" type="button" title="Volver al men√∫ principal" aria-label="Volver al men√∫ principal">‚üµ Men√∫ principal</button>
  </div>

  <script>
  const MIN = 0, MAX = 5;
  const BUBBLES_PER_SEGMENT = 4;
  const COLORS = ["azul","rojo","verde","amarillo"];
  const TOTAL_BUBBLES = (MAX - MIN) * BUBBLES_PER_SEGMENT;
  const SCORE_PER_CORRECT = 100 / TOTAL_BUBBLES;

  function getTolerancePx(){ const w = numberline.clientWidth || 1; return Math.max(16, Math.min(28, Math.round(w * 0.018))); }

  let bubbles = []; let targets = []; let score = 0;

  const numberline = document.getElementById('numberline');
  const palette = document.getElementById('palette');
  const scoreEl = document.getElementById('score');
  const resetBtn = document.getElementById('resetBtn');
  const guide = document.getElementById('guide');

  const randChoice = arr => arr[Math.floor(Math.random()*arr.length)];
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

  function randomDecimalsInSegment(segStart,count){
    const s=new Set();
    while(s.size<count){
      const decimals=Math.random()<0.5?1:2;
      const raw=segStart+Math.random();
      let v=Number(raw.toFixed(decimals));
      if(Number.isInteger(v)) continue;
      s.add(v);
    }
    return Array.from(s).sort((a,b)=>a-b);
  }

  function getLineInsets(){
    const cs=getComputedStyle(numberline);
    const insetL=parseFloat(cs.getPropertyValue('--line-inset-left'))||0;
    const insetR=parseFloat(cs.getPropertyValue('--line-inset-right'))||0;
    return {insetL,insetR};
  }

  function valueToX(value){
    const w=numberline.getBoundingClientRect().width;
    const {insetL,insetR}=getLineInsets();
    const usable=w - insetL - insetR;
    const t=(value-MIN)/(MAX-MIN);
    return insetL + t*usable;
  }

  function renderNumberline(){
    numberline.innerHTML='';
    const lineW = numberline.clientWidth;
    const { insetL, insetR } = getLineInsets();
    const usable = lineW - insetL - insetR;

    for(let i = MIN; i <= MAX; i++){
      const t = (i - MIN) / (MAX - MIN);
      const x = insetL + t * usable;

      const tick = document.createElement('div');
      tick.className = 'tick major';
      tick.style.left = x + 'px';
      numberline.appendChild(tick);

      const label = document.createElement('div');
      label.className = 'label';
      label.style.left = x + 'px';
      label.textContent = i;
      numberline.appendChild(label);

      if(i < MAX){
        for(let m=1; m<10; m++){
          const tm = ( (i + m/10) - MIN ) / (MAX - MIN);
          const xm = insetL + tm * usable;
          const minor = document.createElement('div');
          minor.className = 'tick minor';
          minor.style.left = xm + 'px';
          numberline.appendChild(minor);
        }
      }
    }
    numberline.style.position = 'relative';
  }

  function createTargets(){
    targets=[];
    bubbles.forEach(b=>{
      const t=document.createElement('div');
      t.className='target';
      const x=valueToX(b.value);
      t.style.left=x+'px';
      numberline.appendChild(t);
      targets.push({value:b.value,x});
    });
  }

  function setScore(val){
    score=Math.round(val);
    scoreEl.textContent=`Puntaje: ${score} / 100`;
  }

  function newRound(){
    setScore(0);
    palette.innerHTML='';
    renderNumberline();
    bubbles=[];
    let id=1;
    for(let n=MIN;n<MAX;n++){
      const values=randomDecimalsInSegment(n,BUBBLES_PER_SEGMENT);
      values.forEach(v=>{
        const color=randChoice(COLORS);
        const el=document.createElement('div');
        el.className='marker';
        el.dataset.color=color;
        el.innerHTML = `<div class="tri"></div><div class="tag">${v.toString().replace('.', ',')}</div>`;
        palette.appendChild(el);
        const b={id:id++, value:v, color, placed:false, el, homeParent:palette};
        bubbles.push(b);
        makeDraggable(b);
      });
    }
    createTargets();
  }

  function makeDraggable(b){
    let dragging=false; let offsetX=0, offsetY=0;
    function onPointerDown(e){
      dragging=true; b.el.setPointerCapture(e.pointerId);
      const rect=b.el.getBoundingClientRect();
      offsetX=e.clientX-rect.left; offsetY=e.clientY-rect.top;
      b.el.style.position='fixed'; b.el.style.zIndex=1000;
      b.el.style.left=(e.clientX-offsetX)+'px'; b.el.style.top=(e.clientY-offsetY)+'px';
      guide.style.display='block';
    }
    function onPointerMove(e){
      if(!dragging) return;
      b.el.style.left=(e.clientX-offsetX)+'px'; b.el.style.top=(e.clientY-offsetY)+'px';
      const nl=numberline.getBoundingClientRect();
      if(e.clientY>=nl.top-40 && e.clientY<=nl.bottom+40){
        guide.style.display='block';
        guide.style.left=e.clientX+'px'; guide.style.top=nl.top+'px'; guide.style.height=nl.height+'px';
      } else { guide.style.display='none'; }
    }
    function onPointerUp(e){
      if(!dragging) return;
      dragging=false; b.el.releasePointerCapture(e.pointerId); guide.style.display='none';
      const nl=numberline.getBoundingClientRect(); const elRect=b.el.getBoundingClientRect();
      const tri = b.el.querySelector('.tri'); const triRect = tri.getBoundingClientRect();
      const tipX = triRect.left + triRect.width/2 - nl.left; // punta
      const cx = tipX; const cyMid = elRect.top + elRect.height/2;
      if(!(cyMid>=nl.top-40 && cyMid<=nl.bottom+40)){ returnToPalette(b); return; }
      const tol=getTolerancePx(); const targetX=valueToX(b.value); const dist=Math.abs(cx-targetX);
      if(dist<=tol){
        snapToNumberline(b,targetX);
        if(!b.placed){ b.placed=true; setScore(clamp(score+SCORE_PER_CORRECT,0,100)); }
        if(bubbles.every(bb=>bb.placed)){ setScore(100); celebrate(); }
      } else {
        b.el.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}],{duration:180,iterations:2});
        returnToPalette(b);
      }
    }
    b.el.addEventListener('pointerdown',onPointerDown);
    window.addEventListener('pointermove',onPointerMove);
    window.addEventListener('pointerup',onPointerUp);
  }

  function snapToNumberline(b,xOnLine){
    const nl = numberline.getBoundingClientRect();
    const tri = b.el.querySelector('.tri');
    const triStyles = getComputedStyle(tri);
    const baseHalf = parseFloat(triStyles.borderLeftWidth) || 12;
    const cx = clamp(nl.left + xOnLine, nl.left, nl.right);
    const tipY = nl.top + nl.height/2; // punta toca la recta
    const leftX = cx - baseHalf;
    b.el.style.left = leftX + 'px';
    b.el.style.top = tipY + 'px';
    b.el.style.position = 'fixed';
  }

  function returnToPalette(b){
    b.placed=false; b.el.style.position=''; b.el.style.left=''; b.el.style.top='';
    palette.appendChild(b.el);
  }

  function celebrate(){
    const burst=document.createElement('div');
    burst.style.position='fixed';
    burst.style.inset='0';
    burst.style.pointerEvents='none'; /* ‚Üê FIX aqu√≠ */
    document.body.appendChild(burst);
    const emojis=['‚ú®','üéâ','üåà','‚≠ê','üéØ','üí´'];
    for(let i=0;i<40;i++){
      const s=document.createElement('div');
      s.textContent=emojis[Math.floor(Math.random()*emojis.length)];
      s.style.position='absolute';
      s.style.left=Math.random()*100+'%';
      s.style.top='-10%';
      s.style.fontSize=(16+Math.random()*18)+'px';
      s.style.transition='transform 1.2s ease, opacity 1.2s ease';
      burst.appendChild(s);
      requestAnimationFrame(()=>{
        s.style.transform=`translateY(${120+Math.random()*120}vh) rotate(${Math.random()*360}deg)`;
        s.style.opacity='0';
      });
    }
    setTimeout(()=>burst.remove(),1400);
  }

  resetBtn.addEventListener('click', newRound);
  window.addEventListener('resize', ()=>{ renderNumberline(); createTargets(); });

  // Bot√≥n ‚ÄúMen√∫ principal‚Äù
  document.getElementById('backBtn').addEventListener('click', ()=>{
    if (history.length > 1) history.back();
    else window.location.href = 'index.html'; // ajusta si tu men√∫ se llama diferente
  });

  newRound();
</script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
