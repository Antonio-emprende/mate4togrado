<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Matem√°ticas 4.¬∫ ‚Äì Figuras, Paralelas y Meridianos (Juego)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root{
    --azul:#2563eb; --verde:#10b981; --amarillo:#f59e0b; --rojo:#ef4444; --morado:#7c3aed;
    --gris:#f1f5f9; --borde:#e2e8f0; --texto:#0f172a;
    --radius:18px; --shadow:0 10px 28px rgba(2,6,23,.08);
  }
  body{background:linear-gradient(180deg,#f8fbff 0%,#ffffff 100%);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--texto)}
  .game-card{border:none;border-radius:1rem;box-shadow:var(--shadow)}
  .title-badge{background:linear-gradient(90deg,var(--azul),var(--verde));-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800}
  .score-chip{font-weight:800;border-radius:999px;padding:.45rem .95rem;background:#eef7ff;color:#0d47a1;border:1px solid #d7ebff}
  .btn-fab{border-radius:999px;padding:.65rem 1rem;font-weight:700;box-shadow:0 6px 20px rgba(30,136,229,.25)}

  /* piezas arrastrables */
  .piece{display:flex;flex-direction:column;align-items:center;gap:6px;min-width:110px;
         background:#fff;border:2px solid var(--borde);border-radius:14px;padding:.6rem .8rem;
         cursor:grab;user-select:none;touch-action:none;box-shadow:0 8px 22px rgba(2,6,23,.06)}
  .piece:active{cursor:grabbing;transform:scale(1.04)}
  .piece .name{font-weight:800;font-size:.95rem}
  .dragging{position:fixed;z-index:1000;pointer-events:none;filter:drop-shadow(0 10px 16px rgba(0,0,0,.25))}

  /* zonas destino */
  .dropzone{min-height:140px;background:var(--gris);border:2px dashed var(--borde);border-radius:var(--radius);
            padding:12px;display:flex;flex-wrap:wrap;gap:10px;align-items:flex-start;justify-content:flex-start}
  .dropzone.ok{border-color:#93c5fd;box-shadow:0 0 0 4px rgba(59,130,246,.15) inset}
  .dropzone.good{border-style:solid;background:#f0fdf4;border-color:#86efac}
  .dropzone.bad{border-style:solid;background:#fff1f2;border-color:#fecaca}

  .bank{min-height:120px;background:#fff;border:2px solid var(--borde);border-radius:var(--radius);padding:10px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center}
  .hint{font-size:.9rem}

  .section{border:1px solid var(--borde);border-radius:16px;padding:14px;background:#fff}
  .section h3{font-size:1.05rem;margin-bottom:.35rem}

  .icon{width:72px;height:56px}

  /* globo */
  .globe-wrap{position:relative;max-width:360px;margin:auto}
  .globe{width:100%;height:auto;display:block}
  .target-pin{position:absolute;width:18px;height:18px;border-radius:50%;background:#10b981;box-shadow:0 2px 6px rgba(0,0,0,.18);transform:translate(-50%,-50%)}

  /* ZONAS AMPLIAS DE SOLTADO PARA EL GLOBO */
  .hotzone{
    position:absolute; transform:translate(-50%,-50%);
    border:2px dashed rgba(124,58,237,.35); border-radius:10px;
    pointer-events:auto;
  }
  .hotzone.h-par{ width:80%; height:32px; left:50%; top:50%; } /* banda horizontal Ecuador */
  .hotzone.h-mer{ width:32px; height:80%; left:50%; top:50%; } /* banda vertical Greenwich */
  .hot{ outline:3px solid rgba(124,58,237,.45); outline-offset:6px; } /* resaltado al pasar */

  @media (max-width:576px){
    .piece{min-width:92px}
    .icon{width:62px;height:50px}
  }
</style>
</head>
<body>
<div class="container py-4 py-md-5">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
      <div class="card game-card">
        <div class="card-body p-3 p-md-4 p-lg-5">

          <header class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-3">
            <div>
              <h1 class="h3 m-0 title-badge">Matem√°ticas 4.¬∫ ‚Äì Juego Interactivo</h1>
              <p class="text-secondary m-0">Clasifica figuras, reconoce l√≠neas paralelas y ubica ‚Äúparalelos‚Äù y el <strong>Meridiano de Greenwich</strong>. ¬°Gana puntos!</p>
            </div>
            <div class="d-flex align-items-center gap-2 flex-wrap">
              <span id="score" class="score-chip" aria-live="polite">Puntaje: 0 / 100</span>
              <button id="howBtn" class="btn btn-outline-secondary btn-fab">‚ùì ¬øC√≥mo jugar?</button>
              <button id="checkBtn" class="btn btn-success btn-fab">‚úîÔ∏è Revisar</button>
              <button id="resetBtn" class="btn btn-primary btn-fab">üîÑ Nueva ronda</button>
            </div>
          </header>

          <ul class="nav nav-pills mb-3" id="pills" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="tab-fig" data-bs-toggle="pill" data-bs-target="#pane-fig" type="button" role="tab">1) Figuras planas</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tab-lines" data-bs-toggle="pill" data-bs-target="#pane-lines" type="button" role="tab">2) L√≠neas paralelas</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tab-globe" data-bs-toggle="pill" data-bs-target="#pane-globe" type="button" role="tab">3) Globo terr√°queo</button>
            </li>
          </ul>

          <div class="tab-content">
            <!-- FIGURAS -->
            <div class="tab-pane fade show active" id="pane-fig" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-lg-5">
                  <div class="section">
                    <h3>Banco de piezas</h3>
                    <p class="text-secondary small mb-2">Arrastra cada figura a su categor√≠a. (Pistas visuales y nombres grandes).</p>
                    <div id="bank-fig" class="bank"></div>
                  </div>
                </div>
                <div class="col-12 col-lg-7">
                  <div class="section mb-3">
                    <h3>Paralelogramos</h3>
                    <div id="dz-paralelos" class="dropzone" data-accept="cuadrado,rectangulo,rombo,romboide" aria-label="Zona paralelogramos"></div>
                    <div class="hint text-success mt-2">Tienen <strong>dos pares</strong> de lados paralelos.</div>
                  </div>
                  <div class="section">
                    <h3>No paralelogramos</h3>
                    <div id="dz-nopar" class="dropzone" data-accept="trapecio,trapezoide" aria-label="Zona no paralelogramos"></div>
                    <div class="hint text-muted mt-2">Trapecio: 1 par de lados paralelos. Trapezoide: 0 pares.</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- L√çNEAS -->
            <div class="tab-pane fade" id="pane-lines" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-lg-5">
                  <div class="section">
                    <h3>Banco de parejas de l√≠neas</h3>
                    <p class="text-secondary small mb-2">Lleva cada tarjeta a <em>Paralelas</em> o <em>No paralelas</em>.</p>
                    <div id="bank-lines" class="bank"></div>
                  </div>
                </div>
                <div class="col-12 col-lg-7">
                  <div class="section mb-3">
                    <h3>Paralelas</h3>
                    <div id="dz-lines-ok" class="dropzone" data-accept="paralelas"></div>
                    <div class="hint text-success mt-2">‚ÄúL√≠neas rectas que nunca se llegan a unir‚Äù.</div>
                  </div>
                  <div class="section">
                    <h3>No paralelas</h3>
                    <div id="dz-lines-bad" class="dropzone" data-accept="no-paralelas"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- GLOBO -->
            <div class="tab-pane fade" id="pane-globe" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-lg-5">
                  <div class="section">
                    <h3>Etiquetas</h3>
                    <p class="text-secondary small mb-2">Arrastra cada etiqueta al lugar correcto del globo.</p>
                    <div id="bank-globe" class="bank"></div>
                  </div>
                </div>
                <div class="col-12 col-lg-7">
                  <div class="section">
                    <h3>Globo con rejilla (paralelos y meridianos)</h3>
                    <div class="globe-wrap">
                      <svg id="globe" class="globe" viewBox="0 0 300 300" aria-label="Globo">
                        <defs><clipPath id="c"><circle cx="150" cy="150" r="120"></circle></clipPath></defs>
                        <circle cx="150" cy="150" r="120" fill="#e0f2fe" stroke="#94a3b8" stroke-width="2"/>
                        <g clip-path="url(#c)" stroke-width="1.6" fill="none">
                          <!-- Paralelos (rojo) -->
                          <g id="paralelos" stroke="#ef4444">
                            <line x1="30" y1="60"  x2="270" y2="60"/>
                            <line x1="30" y1="90"  x2="270" y2="90"/>
                            <line x1="30" y1="120" x2="270" y2="120"/>
                            <line x1="30" y1="150" x2="270" y2="150"/> <!-- Ecuador -->
                            <line x1="30" y1="180" x2="270" y2="180"/>
                            <line x1="30" y1="210" x2="270" y2="210"/>
                            <line x1="30" y1="240" x2="270" y2="240"/>
                          </g>
                          <!-- Meridianos (verde) -->
                          <g id="meridianos" stroke="#22c55e">
                            <line x1="60"  y1="30" x2="60"  y2="270"/>
                            <line x1="90"  y1="30" x2="90"  y2="270"/>
                            <line x1="120" y1="30" x2="120" y2="270"/>
                            <line x1="150" y1="30" x2="150" y2="270"/> <!-- Greenwich -->
                            <line x1="180" y1="30" x2="180" y2="270"/>
                            <line x1="210" y1="30" x2="210" y2="270"/>
                            <line x1="240" y1="30" x2="240" y2="270"/>
                          </g>
                        </g>
                      </svg>
                      <!-- ZONAS AMPLIAS PARA SOLTAR -->
                      <div id="zone-paralelos" class="hotzone h-par" title="Paralelos (Ecuador)"></div>
                      <div id="zone-greenwich" class="hotzone h-mer" title="Meridiano de Greenwich"></div>
                      <!-- Pines de referencia -->
                      <div id="pin-paralelos" class="target-pin" style="left:50%; top:50%" title="Ecuador"></div>
                      <div id="pin-greenwich" class="target-pin" style="left:50%; top:12%" title="Greenwich"></div>
                    </div>
                    <div class="hint text-muted mt-2">
                      <strong>Paralelos</strong> (rojo): l√≠neas horizontales (Ecuador es 0¬∞ lat.).  
                      <strong>Meridianos</strong> (verde): l√≠neas verticales (Greenwich es 0¬∞ long.).
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-3 small text-muted">Consejo: si una pieza vuelve al banco es que no pertenece a esa zona. ¬°Sigue intentando! üòä</div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal ¬øC√≥mo jugar? -->
<div class="modal fade" id="howModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title">¬øC√≥mo se juega?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <ol class="mb-0 ps-3">
          <li>Hay <strong>3 actividades</strong> (pesta√±as). Cambia entre ellas cuando quieras.</li>
          <li><strong>Arrastra</strong> las tarjetas/etiquetas a la zona correcta. En celular o tablet, arrastra con el dedo.</li>
          <li>El <strong>puntaje sube en vivo</strong> cuando aciertas. Con 100 sale confeti üéâ.</li>
          <li>Presiona <strong>‚úîÔ∏è Revisar</strong> si quieres ver ‚úì/‚úñ en cada pieza.</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Modal resultado -->
<div class="modal fade" id="resultModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-2 p-md-3">
      <div class="modal-header border-0 justify-content-center">
        <div style="font-size:48px">üéâ‚ú®</div>
      </div>
      <div class="modal-body">
        <h3 id="resultTitle" class="mb-2">¬°Excelente!</h3>
        <p id="resultText" class="lead mb-0"></p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Seguir practicando</button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  "use strict";

  // ===== util =====
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  let score = 0;
  let celebrated = false;
  function setScore(v){ score = Math.round(v); $('#score').textContent = `Puntaje: ${score} / 100`; }

  // ===== datos =====
  const FIGURES = [
    {id:'cuadrado',    name:'Cuadrado',    svg:drawSquare('#22c55e')},
    {id:'rectangulo',  name:'Rect√°ngulo',  svg:drawRect('#3b82f6')},
    {id:'rombo',       name:'Rombo',       svg:drawRhombus('#eab308')},
    {id:'romboide',    name:'Romboide',    svg:drawParallelogram('#a855f7')},
    {id:'trapecio',    name:'Trapecio',    svg:drawTrapezoid('#f97316')},
    {id:'trapezoide',  name:'Trapezoide',  svg:drawKite('#ef4444')}
  ];

  /* === ACT. 2: ahora 3 paralelas distintas (sin duplicados) + 2 no paralelas === */
  const LINES = [
    {id:'ph', kind:'paralelas',    name:'Paralelas horizontales', svg:linesParallelHorizontal()},
    {id:'pv', kind:'paralelas',    name:'Paralelas verticales',   svg:linesParallelVertical()},
    {id:'pd', kind:'paralelas',    name:'Paralelas diagonales (45¬∞)', svg:linesParallelDiagonal()},
    {id:'n1', kind:'no-paralelas', name:'No paralelas (cruzadas)',   svg:linesIntersect()},
    {id:'n2', kind:'no-paralelas', name:'No paralelas (divergen)',   svg:linesDiverge()}
  ];

  /* >>> ACT. 3: etiquetas del globo usan zonas amplias */
  const GLOBE_LABELS = [
    {id:'lbl-paralelos', name:'Paralelos (Ecuador)', accept:'zone-paralelos'},
    {id:'lbl-greenwich', name:'Meridiano de Greenwich', accept:'zone-greenwich'}
  ];

  // ===== render =====
  function renderBankFigure(){
    const bank = $('#bank-fig'); bank.innerHTML='';
    shuffle(FIGURES).forEach(f => bank.appendChild(makePiece(f.id, f.name, f.svg, 'fig')));
  }
  function renderBankLines(){
    const bank = $('#bank-lines'); bank.innerHTML='';
    shuffle(LINES).forEach(l => bank.appendChild(makePiece(l.id, l.name, l.svg, 'lin', l.kind)));
  }
  function renderBankGlobe(){
    const bank = $('#bank-globe'); bank.innerHTML='';
    shuffle(GLOBE_LABELS).forEach(g => {
      const tag = document.createElement('div');
      tag.className='piece'; tag.dataset.type='glb'; tag.dataset.id=g.id; tag.dataset.accept=g.accept;
      tag.innerHTML = `<div class="name">${g.name}</div>`;
      makeDraggable(tag);
      bank.appendChild(tag);
    });
  }

  function makePiece(id, name, svg, type, kind){
    const el = document.createElement('div');
    el.className='piece'; el.dataset.id=id; el.dataset.type=type;
    if(kind){ el.dataset.kind = kind; }
    el.innerHTML = `${svg}<div class="name">${name}</div>`;
    makeDraggable(el);
    return el;
  }

  // ===== drag & drop =====
  function makeDraggable(src){
    src.addEventListener('pointerdown', (e)=>{
      const ghost = src.cloneNode(true);
      ghost.classList.add('dragging');
      document.body.appendChild(ghost);
      const r = ghost.getBoundingClientRect(); let offX = r.width/2, offY = r.height/2;
      moveAt(e.clientX,e.clientY);
      function moveAt(x,y){ ghost.style.left=(x-offX)+'px'; ghost.style.top=(y-offY)+'px'; }
      function onMove(ev){ moveAt(ev.clientX,ev.clientY); highlight(ev.clientX,ev.clientY, src); }
      function onUp(ev){
        document.removeEventListener('pointermove',onMove);
        document.removeEventListener('pointerup',onUp);
        const done = drop(ev.clientX,ev.clientY, src);
        if(!done) bounce(src);
        ghost.remove(); clearHighlights();
      }
      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', onUp, {once:true});
    }, {passive:true});
  }
  function elementAt(x,y){ return document.elementFromPoint(x,y); }

  function highlight(x,y, src){
    clearHighlights();
    const el = elementAt(x,y);
    let dz = null;
    if(el){ dz = el.classList && el.classList.contains('dropzone') ? el : (el.closest ? el.closest('.dropzone') : null); }
    if(dz){ dz.classList.add('ok'); }
    if(src.dataset.type==='glb'){
      const zone = (el && (el.id==='zone-paralelos' || el.id==='zone-greenwich')) ? el : (el && el.closest ? el.closest('.hotzone') : null);
      if(zone){ zone.classList.add('hot'); }
    }
  }
  function clearHighlights(){
    $$('.dropzone').forEach(d=>d.classList.remove('ok'));
    $$('.hotzone').forEach(z=>z.classList.remove('hot'));
  }

  function drop(x,y, src){
    const el = elementAt(x,y);
    // zonas de figuras/l√≠neas
    let dz = null;
    if(el){ dz = el.classList && el.classList.contains('dropzone') ? el : (el.closest ? el.closest('.dropzone') : null); }
    if(dz && (src.dataset.type==='fig' || src.dataset.type==='lin')){
      const allow = (src.dataset.type==='fig')
        ? dz.dataset.accept.split(',').map(s=>s.trim())
        : [dz.dataset.accept];
      const key = (src.dataset.type==='fig') ? src.dataset.id : src.dataset.kind;
      if(allow.indexOf(key)>=0){
        dz.classList.add('good'); dz.classList.remove('bad');
        dz.appendChild(src);
        src.dataset.correct='1';
      }else{
        dz.classList.add('bad'); dz.classList.remove('good');
        src.dataset.correct='0';
        const bank = (src.dataset.type==='fig') ? $('#bank-fig') : $('#bank-lines');
        bank.appendChild(src);
      }
      computeAndSetScoreLive();
      return true;
    }

    // zonas amplias del globo
    if(src.dataset.type==='glb'){
      const zone = (el && (el.id==='zone-paralelos' || el.id==='zone-greenwich')) ? el : (el && el.closest ? el.closest('.hotzone') : null);
      if(zone){
        const must = src.dataset.accept; // 'zone-paralelos' o 'zone-greenwich'
        if(zone.id===must){
          const wrapRect = $('.globe-wrap').getBoundingClientRect();
          const zRect = zone.getBoundingClientRect();
          const container = $('.globe-wrap');
          src.style.position='absolute';
          container.appendChild(src);
          // colocaci√≥n agradable seg√∫n zona
          if(zone.id==='zone-paralelos'){
            src.style.left = (zRect.left - wrapRect.left + zRect.width*0.65) + 'px';
            src.style.top  = (zRect.top  - wrapRect.top + zRect.height*0.10) + 'px';
          }else{
            src.style.left = (zRect.left - wrapRect.left + zRect.width*0.55) + 'px';
            src.style.top  = (zRect.top  - wrapRect.top + zRect.height*0.75) + 'px';
          }
          src.dataset.correct='1';
        }else{
          $('#bank-globe').appendChild(src);
          src.dataset.correct='0';
        }
        computeAndSetScoreLive();
        return true;
      }
    }
    return false;
  }

  function bounce(el){
    el.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}],{duration:180,iterations:2});
  }

  // ===== Puntaje =====
  function computeAndSetScoreLive(){
    const total = FIGURES.length + LINES.length + GLOBE_LABELS.length; // 6 + 5 + 2 = 13
    let ok = 0;
    $$('.piece').forEach(p=>{ if(p.dataset.correct==='1') ok++; });
    const val = (ok/total)*100;
    setScore(val);
    if(val===100 && !celebrated){ confetti(); celebrated=true; }
  }

  function checkAll(){
    const total = FIGURES.length + LINES.length + GLOBE_LABELS.length;
    let ok = 0;
    $$('.piece').forEach(p=>{
      if(p.dataset.correct==='1'){ ok++; p.style.borderColor='#86efac'; p.style.background='#f0fdf4'; }
      else if(p.dataset.correct==='0'){ p.style.borderColor='#fecaca'; p.style.background='#fff1f2'; }
    });
    const val = (ok/total)*100;
    setScore(val);
    showResult(val);
    if(val===100){ celebrated=true; } // para no duplicar confeti
  }

  function showResult(val){
    const t = $('#resultTitle'), txt = $('#resultText');
    if(val===100){ t.textContent='¬°Has ganado!'; txt.textContent='¬°Sacaste un 100! üòä'; }
    else if(val>=70){ t.textContent='¬°Muy bien!'; txt.textContent=`Tu puntaje fue ${val.toFixed(0)} / 100. Revisa piezas en rojo y vuelve a intentar.`; }
    else { t.textContent='¬°T√∫ puedes!'; txt.textContent=`Tu puntaje fue ${val.toFixed(0)} / 100. Practica un poquito m√°s.`; }
    if(window.bootstrap){ new bootstrap.Modal('#resultModal').show(); }
    else { alert(`${t.textContent}\n${txt.textContent}`); }
  }

  function resetGame(){
    celebrated=false;
    setScore(0);
    $$('.piece').forEach(p=>{ p.dataset.correct=''; p.style.borderColor=''; p.style.background=''; p.style.position=''; p.style.left=''; p.style.top=''; });
    renderBankFigure(); renderBankLines(); renderBankGlobe();
    $('#dz-paralelos').innerHTML='';
    $('#dz-nopar').innerHTML='';
    $('#dz-lines-ok').innerHTML='';
    $('#dz-lines-bad').innerHTML='';
  }

  // ===== SVG helpers =====
  function drawSquare(color){ return '<svg class="icon" viewBox="0 0 100 70" aria-hidden="true"><rect x="20" y="10" width="60" height="50" rx="6" fill="'+color+'" opacity=".15" stroke="'+color+'" stroke-width="4"/></svg>'; }
  function drawRect(color){ return '<svg class="icon" viewBox="0 0 120 70" aria-hidden="true"><rect x="12" y="16" width="96" height="38" rx="6" fill="'+color+'" opacity=".15" stroke="'+color+'" stroke-width="4"/></svg>'; }
  function drawRhombus(color){ return '<svg class="icon" viewBox="0 0 120 70" aria-hidden="true"><polygon points="60,8 100,35 60,62 20,35" fill="'+color+'" opacity=".15" stroke="'+color+'" stroke-width="4"/></svg>'; }
  function drawParallelogram(color){ return '<svg class="icon" viewBox="0 0 120 70" aria-hidden="true"><polygon points="25,18 100,18 95,52 20,52" fill="'+color+'" opacity=".15" stroke="'+color+'" stroke-width="4"/></svg>'; }
  function drawTrapezoid(color){ return '<svg class="icon" viewBox="0 0 120 70" aria-hidden="true"><polygon points="30,18 90,18 100,52 20,52" fill="'+color+'" opacity=".15" stroke="'+color+'" stroke-width="4"/></svg>'; }
  function drawKite(color){ return '<svg class="icon" viewBox="0 0 120 70" aria-hidden="true"><polygon points="60,8 92,35 60,62 28,35" fill="'+color+'" opacity=".15" stroke="'+color+'" stroke-width="4" transform="skewX(10)"/></svg>'; }

  /* === L√≠neas para la actividad 2 === */
  function linesParallelHorizontal(){ return '<svg class="icon" viewBox="0 0 120 70"><line x1="12" y1="20" x2="108" y2="20" stroke="#0f172a" stroke-width="4"/><line x1="12" y1="50" x2="108" y2="50" stroke="#0f172a" stroke-width="4"/></svg>'; }
  function linesParallelVertical(){ return '<svg class="icon" viewBox="0 0 120 70"><line x1="40" y1="10" x2="40" y2="60" stroke="#0f172a" stroke-width="4"/><line x1="80" y1="10" x2="80" y2="60" stroke="#0f172a" stroke-width="4"/></svg>'; }
  function linesParallelDiagonal(){ return '<svg class="icon" viewBox="0 0 120 70"><line x1="10" y1="60" x2="70" y2="10" stroke="#0f172a" stroke-width="4"/><line x1="50" y1="60" x2="110" y2="10" stroke="#0f172a" stroke-width="4"/></svg>'; }
  function linesIntersect(){ return '<svg class="icon" viewBox="0 0 120 70"><line x1="20" y1="15" x2="100" y2="55" stroke="#991b1b" stroke-width="4"/><line x1="20" y1="55" x2="100" y2="15" stroke="#991b1b" stroke-width="4"/></svg>'; }
  function linesDiverge(){ return '<svg class="icon" viewBox="0 0 120 70"><line x1="20" y1="58" x2="100" y2="40" stroke="#b45309" stroke-width="4"/><line x1="20" y1="12" x2="100" y2="20" stroke="#b45309" stroke-width="4"/></svg>'; }

  function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }
  function confetti(){
    const burst=document.createElement('div'); burst.style.position='fixed'; burst.style.inset='0'; burst.style.pointerEvents='none'; document.body.appendChild(burst);
    const emojis=['‚ú®','üéâ','‚≠ê','üéØ','üí´','üèÜ'];
    for(let i=0;i<60;i++){
      const s=document.createElement('div'); s.textContent=emojis[Math.floor(Math.random()*emojis.length)];
      s.style.position='absolute'; s.style.left=Math.random()*100+'%'; s.style.top='-10%';
      s.style.fontSize=(16+Math.random()*22)+'px'; s.style.transition='transform 1.3s ease, opacity 1.3s ease';
      burst.appendChild(s);
      requestAnimationFrame(()=>{ s.style.transform='translateY('+ (120+Math.random()*120) +'vh) rotate('+ (Math.random()*360) +'deg)'; s.style.opacity='0'; });
    }
    setTimeout(()=>burst.remove(),1400);
  }

  // ===== botones =====
  function initButtons(){
    $('#checkBtn').addEventListener('click', checkAll);
    $('#resetBtn').addEventListener('click', resetGame);
    $('#howBtn').addEventListener('click', ()=>{
      if(window.bootstrap){ new bootstrap.Modal('#howModal').show(); }
      else{ alert('Arrastra las tarjetas a las zonas correctas y presiona Revisar.'); }
    });
  }

  // ===== inicio seguro =====
  function init(){
    setScore(0);
    renderBankFigure(); renderBankLines(); renderBankGlobe();
    initButtons();
  }
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init); }
  else{ init(); }

})();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
